---
toc:
  beginning: true
giscus_comments: true
layout: post
title: "分布式系統接口如何避免表单的重复提交"
date: "2022-02-06"
categories: 
  - "分布式"
---



# 幂等性
**效果：**系统对某接口的多次请求，都应该返回同样的结果
**目的：**避免因为各种原因，重复请求导致的业务重复处理

## 场景案例
1. 客户端第一次请求后，网络异常导致收到请求执行逻辑但是没有返回给客户端，客户端的重新发起请求
2. 客户端迅速点击按钮提交，导致同一逻辑被多次发送到服务器

- 对于查询：只读操作必然符合幂等性要求
- 对于删除：重复删除不会造成数据紊乱，不过有些场景不喜欢出现目标不存在的提示
- 对于新增与修改：**新增需要避免重复插入，修改需要避免无效的重复修改**

## 幂等性的实现方式
**实现方法**
客户端做某一请求的时候带上识别参数标志，服务端对此标识进行识别，重复请求则返回第一次结果即可。

比如添加请求的表单里，在打开添加表单页面的时候，就生成一个AddId标识，这个AddId跟着表单一起提交到后台接口。

后台接口根据这个AddId，服务端就可以进行缓存标记并进行过滤，缓存值可以是AddId作为缓存key，返回内容作为缓存Value，这样即使添加按钮被多次点下也可以识别出来。

这个AddId什么时候更新呢？只有在保存成功并且清空表单之后，才变更这个AddId标识，从而实现新数据的表单提交
